<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unlock-the-Vault (Keys & Cyber Lock) â€” Email Security</title>
<style>
  :root{
    --bg0:#050816;
    --bg1:#070b1d;
    --panel: rgba(255,255,255,.06);
    --stroke: rgba(255,255,255,.12);
    --ink:#EAF1FF;
    --muted:#A9B6D7;

    --cyan:#55D6FF;
    --cyan2:#2C7BFF;

    --good:#2EE59D;
    --bad:#FF5A7A;

    --gold1:#F7D36A;
    --gold2:#B8872B;

    --shadow: 0 18px 70px rgba(0,0,0,.55);
    --r: 18px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    min-height:100vh;
    display:flex; justify-content:center; align-items:center;
    padding:16px;
    background:
      radial-gradient(1100px 650px at 50% 20%, rgba(85,214,255,.22), rgba(85,214,255,0) 55%),
      radial-gradient(900px 550px at 20% 70%, rgba(44,123,255,.18), rgba(44,123,255,0) 60%),
      radial-gradient(900px 550px at 80% 70%, rgba(162,28,255,.14), rgba(162,28,255,0) 60%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    overflow-x:hidden;
  }
  .wrap{width:min(1100px, 100%);}

  header{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    margin-bottom:12px; flex-wrap:wrap;
  }
  .brand{display:flex; align-items:center; gap:10px;}
  .logo{
    width:44px;height:44px;border-radius:14px;
    background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.55), rgba(85,214,255,.55) 35%, rgba(44,123,255,.75) 70%, rgba(0,0,0,.35));
    box-shadow: 0 12px 30px rgba(85,214,255,.18);
    border:1px solid rgba(255,255,255,.14);
  }
  .title h1{margin:0;font-size:16.5px;letter-spacing:.2px}
  .title p{margin:2px 0 0;color:var(--muted);font-size:12.5px;line-height:1.25}

  .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .pill{
    display:flex; align-items:center; gap:8px;
    padding:10px 12px;
    border-radius:999px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(8px);
  }
  .pill span{color:var(--muted); font-size:12.5px}
  .pill b{font-size:13px}
  .btn{
    appearance:none; border:0; cursor:pointer;
    padding:10px 12px;
    border-radius:12px;
    color:var(--ink);
    background: rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.12);
    box-shadow: 0 10px 26px rgba(0,0,0,.25);
    transition: transform .12s ease, filter .12s ease;
  }
  .btn:hover{transform: translateY(-1px); filter: brightness(1.05)}
  .btn:active{transform: translateY(0)}
  .btn.primary{
    background: linear-gradient(180deg, rgba(85,214,255,.95), rgba(44,123,255,.95));
    border:1px solid rgba(255,255,255,.18);
  }
  .btn.danger{
    background: linear-gradient(180deg, rgba(255,90,122,.95), rgba(225,29,72,.95));
    border:1px solid rgba(255,255,255,.16);
  }

  .grid{
    display:grid;
    grid-template-columns: 1.35fr .85fr;
    gap:14px;
  }
  @media (max-width: 920px){
    .grid{grid-template-columns: 1fr;}
  }

  /* ==== main board ==== */
  .board{
    border-radius: var(--r);
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.12);
    box-shadow: var(--shadow);
    overflow:hidden;
    position:relative;
  }
  .boardInner{padding:14px; position:relative;}

  .starfield{
    position:absolute; inset:0;
    background:
      radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,.6), rgba(255,255,255,0) 60%),
      radial-gradient(2px 2px at 22% 72%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
      radial-gradient(2px 2px at 66% 22%, rgba(255,255,255,.5), rgba(255,255,255,0) 60%),
      radial-gradient(2px 2px at 82% 64%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
      radial-gradient(2px 2px at 48% 80%, rgba(255,255,255,.45), rgba(255,255,255,0) 60%),
      radial-gradient(2px 2px at 90% 30%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%);
    opacity:.55;
    pointer-events:none;
  }

  .arena{
    border-radius: 18px;
    background:
      radial-gradient(900px 600px at 50% 35%, rgba(85,214,255,.18), rgba(85,214,255,0) 60%),
      linear-gradient(180deg, rgba(7,12,28,.92), rgba(5,8,18,.92));
    border:1px solid rgba(255,255,255,.10);
    padding:16px;
    position:relative;
    overflow:hidden;
  }

  /* radar rings */
  .rings{
    position:absolute; inset:0;
    pointer-events:none;
    opacity:.65;
  }
  .scanLine{
    position:absolute;
    left:-40%;
    top:0;
    width:40%;
    height:100%;
    background: linear-gradient(90deg, rgba(255,255,255,0), rgba(85,214,255,.20), rgba(255,255,255,0));
    transform: skewX(-16deg);
    animation: scan 4.8s ease-in-out infinite;
    opacity:.55;
    pointer-events:none;
  }
  @keyframes scan{
    0%, 35%{transform: translateX(-60%) skewX(-16deg)}
    70%{transform: translateX(290%) skewX(-16deg)}
    100%{transform: translateX(290%) skewX(-16deg)}
  }

  /* center lock */
  .center{
    display:grid;
    grid-template-columns: 1fr 330px 1fr;
    gap:12px;
    align-items:center;
  }
  @media (max-width: 720px){
    .center{grid-template-columns: 1fr;}
  }

  .lockWrap{
    display:flex;
    justify-content:center;
    align-items:center;
    padding:10px 0;
    position:relative;
  }

  .lockGlow{
    position:absolute;
    width:280px;height:280px;border-radius:50%;
    background: radial-gradient(circle at 50% 50%, rgba(85,214,255,.35), rgba(85,214,255,0) 65%);
    filter: blur(0px);
    pointer-events:none;
  }

  .lockSvg{
    width:240px;
    max-width: 70vw;
    filter: drop-shadow(0 22px 35px rgba(0,0,0,.55));
    z-index:1;
  }

  /* keys: desktop orbit */
  .keysCol{
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  @media (max-width: 720px){
    .keysCol{display:none;}
  }

  .keyBtn{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:10px 12px;
    border-radius: 16px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    cursor:pointer;
    user-select:none;
    transition: transform .12s ease, filter .12s ease, background .12s ease;
    position:relative;
    overflow:hidden;
  }
  .keyBtn:hover{transform: translateY(-2px); filter: brightness(1.05)}
  .keyBtn:active{transform: translateY(0)}
  .keyBtn.disabled{opacity:.55; cursor:not-allowed; filter:saturate(.7)}
  .keyLabel{display:flex; flex-direction:column; gap:2px;}
  .keyLabel b{font-size:12.8px; letter-spacing:.2px}
  .keyLabel small{color:var(--muted); font-size:11.8px}
  .statusPip{
    width:10px;height:10px;border-radius:50%;
    background: rgba(255,255,255,.20);
    box-shadow: 0 0 0 3px rgba(255,255,255,.06);
  }
  .statusPip.good{background: var(--good); box-shadow: 0 0 0 3px rgba(46,229,157,.12), 0 0 18px rgba(46,229,157,.22)}
  .statusPip.bad{background: var(--bad); box-shadow: 0 0 0 3px rgba(255,90,122,.12), 0 0 18px rgba(255,90,122,.22)}

  .keyIcon{
    width:78px; height:26px;
    filter: drop-shadow(0 10px 16px rgba(0,0,0,.45));
  }

  /* mobile key list */
  .keysMobile{
    display:none;
    margin-top:12px;
    gap:10px;
  }
  @media (max-width: 720px){
    .keysMobile{display:grid;}
    .keysMobile{grid-template-columns: repeat(2, 1fr);}
  }
  .keyCard{
    border-radius: 16px;
    padding:10px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    cursor:pointer;
    transition: transform .12s ease, filter .12s ease;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .keyCard:hover{transform: translateY(-1px); filter: brightness(1.05)}
  .keyCard:active{transform: translateY(0)}
  .keyCard.disabled{opacity:.55; cursor:not-allowed; filter:saturate(.7)}
  .keyCard b{font-size:12.5px}
  .keyCard small{display:block;color:var(--muted);font-size:11.5px;margin-top:2px}

  /* progress */
  .footerRow{
    margin-top:14px;
    display:flex; align-items:center; justify-content:space-between;
    gap:10px; flex-wrap:wrap;
  }
  .bar{
    width:220px; height:10px; border-radius:999px;
    background: rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.10);
    overflow:hidden;
  }
  .bar > i{
    display:block; height:100%; width:0%;
    background: linear-gradient(90deg, rgba(46,229,157,.95), rgba(85,214,255,.95));
    border-radius:999px;
    transition: width .35s ease;
  }
  .hint{color:var(--muted); font-size:12.5px}

  /* right panel */
  .side{
    border-radius: var(--r);
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.12);
    box-shadow: var(--shadow);
    overflow:hidden;
  }
  .sideInner{padding:14px}
  .sideInner h2{margin:0;font-size:15px}
  .sideInner p{margin:6px 0 0; color:var(--muted); font-size:12.5px; line-height:1.35}
  .stats{
    margin-top:12px;
    display:grid; grid-template-columns: 1fr 1fr;
    gap:10px;
  }
  .stat{
    border-radius: 14px;
    background: rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.10);
    padding:10px;
  }
  .stat b{display:block;font-size:16px}
  .stat span{display:block;color:var(--muted);font-size:12px;margin-top:2px}
  .note{
    margin-top:12px;
    border-radius: 14px;
    padding:10px;
    background: rgba(85,214,255,.10);
    border:1px solid rgba(85,214,255,.20);
    font-size:12.5px; line-height:1.35;
  }

  /* modal */
  .overlay{
    position:fixed; inset:0;
    background: rgba(0,0,0,.58);
    display:none;
    align-items:center; justify-content:center;
    padding:16px;
    z-index:50;
  }
  .overlay.show{display:flex}
  .modal{
    width:min(780px, 100%);
    border-radius: 18px;
    background: linear-gradient(180deg, rgba(20,34,66,.96), rgba(9,12,22,.96));
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: 0 30px 120px rgba(0,0,0,.65);
    overflow:hidden;
    position:relative;
  }
  .modal::before{
    content:"";
    position:absolute; inset:-60% -40% auto -40%;
    height:65%;
    background: radial-gradient(circle at 50% 60%, rgba(247,211,106,.20), rgba(247,211,106,0) 70%);
    pointer-events:none;
  }
  .mHead{
    padding:14px 14px 10px;
    display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
    position:relative;
  }
  .mHead h3{margin:0; font-size:15.5px}
  .mHead small{display:block; color:var(--muted); margin-top:4px}
  .mBody{padding:0 14px 14px; position:relative;}
  .qText{
    margin:10px 0 12px;
    font-size:15px;
    line-height:1.4;
  }
  .choices{display:grid; gap:10px;}
  .choice{
    width:100%;
    text-align:left;
    padding:12px 12px;
    border-radius:14px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    color:var(--ink);
    cursor:pointer;
    transition: transform .10s ease, background .12s ease, border-color .12s ease;
  }
  .choice:hover{transform: translateY(-1px); background: rgba(255,255,255,.08)}
  .choice:active{transform: translateY(0px)}
  .choice[disabled]{cursor:not-allowed; opacity:.78}
  .choice.good{
    border-color: rgba(46,229,157,.45);
    background: rgba(46,229,157,.12);
  }
  .choice.bad{
    border-color: rgba(255,90,122,.45);
    background: rgba(255,90,122,.10);
  }
  .mFoot{
    display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
    padding:12px 14px 14px;
    border-top:1px solid rgba(255,255,255,.08);
    background: rgba(0,0,0,.12);
    position:relative;
  }
  .toast{
    position:fixed;
    left:50%; top:18px; transform:translateX(-50%);
    padding:10px 12px;
    border-radius: 999px;
    background: rgba(0,0,0,.55);
    border: 1px solid rgba(255,255,255,.15);
    color: var(--ink);
    font-size: 12.5px;
    display:none;
    z-index:80;
    backdrop-filter: blur(10px);
  }
  .toast.show{display:block; animation: pop .18s ease}
  @keyframes pop{from{transform:translateX(-50%) scale(.95); opacity:.6} to{transform:translateX(-50%) scale(1); opacity:1}}

  /* effects */
  .shake{animation: shake .35s ease}
  @keyframes shake{
    0%{transform: translateX(0)}
    25%{transform: translateX(-5px)}
    50%{transform: translateX(5px)}
    75%{transform: translateX(-4px)}
    100%{transform: translateX(0)}
  }
  .pulse{animation: pulse .45s ease}
  @keyframes pulse{
    0%{filter: brightness(1)}
    50%{filter: brightness(1.15)}
    100%{filter: brightness(1)}
  }

  .confetti{
    position:absolute; inset:0;
    pointer-events:none;
    opacity:0;
  }
  .confetti.show{opacity:1; animation: fadeOut 1.2s ease forwards}
  @keyframes fadeOut{0%{opacity:1} 100%{opacity:0}}

  /* small helper */
  .kbd{
    font-size:12px; color:var(--muted);
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">
        <h1>Unlock-the-Vault â€” Email Security Keys</h1>
        <p>Open keys in order. One attempt per key. Correct keys unlock the cyber lock.</p>
      </div>
    </div>
    <div class="actions">
      <div class="pill"><span>Keys</span><b id="done">0</b><span>/</span><b id="total">10</b></div>
      <div class="pill"><span>Score</span><b id="score">0</b></div>
      <button class="btn" id="muteBtn" type="button">ðŸ”Š Sound</button>
      <button class="btn danger" id="resetBtn" type="button">Reset</button>
    </div>
  </header>

  <div class="grid">
    <section class="board">
      <div class="starfield"></div>
      <div class="boardInner">
        <div class="arena" id="arena">
          <svg class="rings" viewBox="0 0 1000 700" preserveAspectRatio="none" aria-hidden="true">
            <defs>
              <radialGradient id="rg" cx="50%" cy="50%" r="60%">
                <stop offset="0%" stop-color="rgba(85,214,255,.25)"/>
                <stop offset="60%" stop-color="rgba(85,214,255,.05)"/>
                <stop offset="100%" stop-color="rgba(85,214,255,0)"/>
              </radialGradient>
            </defs>
            <circle cx="500" cy="350" r="250" fill="none" stroke="rgba(85,214,255,.18)" stroke-width="2"/>
            <circle cx="500" cy="350" r="190" fill="none" stroke="rgba(85,214,255,.14)" stroke-width="2"/>
            <circle cx="500" cy="350" r="130" fill="none" stroke="rgba(85,214,255,.10)" stroke-width="2"/>
            <circle cx="500" cy="350" r="290" fill="none" stroke="rgba(255,255,255,.06)" stroke-width="2"/>
            <circle cx="500" cy="350" r="330" fill="url(#rg)" opacity=".55"/>
          </svg>
          <div class="scanLine"></div>

          <div class="center">
            <div class="keysCol" id="keysLeft"></div>

            <div class="lockWrap">
              <div class="lockGlow" id="lockGlow"></div>

              <!-- Conceptual cyber lock (SVG) -->
              <svg class="lockSvg" viewBox="0 0 260 300" aria-label="Cyber lock">
                <defs>
                  <linearGradient id="steel" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0" stop-color="#E6EDF8"/>
                    <stop offset=".35" stop-color="#9AA6B8"/>
                    <stop offset="1" stop-color="#2B3445"/>
                  </linearGradient>
                  <linearGradient id="body" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0" stop-color="#1B2640"/>
                    <stop offset=".55" stop-color="#101a2f"/>
                    <stop offset="1" stop-color="#0a1020"/>
                  </linearGradient>
                  <linearGradient id="neon" x1="0" y1="0" x2="1" y2="0">
                    <stop offset="0" stop-color="rgba(85,214,255,.9)"/>
                    <stop offset="1" stop-color="rgba(46,229,157,.9)"/>
                  </linearGradient>
                  <radialGradient id="glow" cx="50%" cy="48%" r="60%">
                    <stop offset="0" stop-color="rgba(85,214,255,.45)"/>
                    <stop offset="70%" stop-color="rgba(85,214,255,.08)"/>
                    <stop offset="100%" stop-color="rgba(85,214,255,0)"/>
                  </radialGradient>
                </defs>

                <!-- outer glow -->
                <circle cx="130" cy="165" r="120" fill="url(#glow)" opacity=".75"/>

                <!-- shackle -->
                <path d="M75 110V70c0-33 22-55 55-55s55 22 55 55v40"
                      fill="none" stroke="url(#steel)" stroke-width="16" stroke-linecap="round"/>
                <path d="M88 110V72c0-25 17-41 42-41s42 16 42 41v38"
                      fill="none" stroke="rgba(255,255,255,.25)" stroke-width="4" stroke-linecap="round"/>

                <!-- body -->
                <path d="M45 110h170c14 0 25 11 25 25v105c0 30-24 55-55 55H75c-30 0-55-25-55-55V135c0-14 11-25 25-25z"
                      fill="url(#body)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>

                <!-- cyber panel lines -->
                <rect x="62" y="148" width="136" height="14" rx="7" fill="rgba(85,214,255,.14)"/>
                <rect x="62" y="170" width="136" height="14" rx="7" fill="rgba(85,214,255,.10)"/>
                <rect x="62" y="192" width="136" height="14" rx="7" fill="rgba(85,214,255,.08)"/>
                <rect x="62" y="214" width="136" height="14" rx="7" fill="rgba(46,229,157,.10)"/>

                <!-- center keyhole plate -->
                <circle cx="130" cy="205" r="48" fill="rgba(0,0,0,.25)" stroke="rgba(255,255,255,.10)" stroke-width="2"/>
                <circle cx="130" cy="205" r="36" fill="rgba(10,14,24,.55)" stroke="rgba(85,214,255,.18)" stroke-width="2"/>

                <!-- keyhole -->
                <path d="M130 188c-10 0-18 8-18 18 0 7 4 13 10 16v28c0 4 3 7 8 7h0c5 0 8-3 8-7v-28c6-3 10-9 10-16 0-10-8-18-18-18z"
                      fill="rgba(85,214,255,.85)"/>
                <path d="M130 195c-5 0-9 4-9 9 0 4 3 8 7 9v27c0 2 1 3 2 3s2-1 2-3v-27c4-1 7-5 7-9 0-5-4-9-9-9z"
                      fill="rgba(255,255,255,.35)"/>

                <!-- small corner bolts -->
                <circle cx="62" cy="136" r="4" fill="rgba(255,255,255,.25)"/>
                <circle cx="198" cy="136" r="4" fill="rgba(255,255,255,.25)"/>
                <circle cx="62" cy="270" r="4" fill="rgba(255,255,255,.25)"/>
                <circle cx="198" cy="270" r="4" fill="rgba(255,255,255,.25)"/>
              </svg>

              <canvas class="confetti" id="confetti"></canvas>
            </div>

            <div class="keysCol" id="keysRight"></div>
          </div>

          <div class="keysMobile" id="keysMobile"></div>

          <div class="footerRow">
            <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
              <div class="bar"><i id="barFill"></i></div>
              <span class="hint" id="barText">0% keys used</span>
            </div>
            <span class="kbd">Tap the next key to proceed</span>
          </div>
        </div>
      </div>
    </section>

    <aside class="side">
      <div class="sideInner">
        <h2>Session Summary</h2>
        <p>Clean GBL data: key-wise accuracy, time, and where learners get stuck.</p>

        <div class="stats">
          <div class="stat"><b id="acc">0%</b><span>Accuracy</span></div>
          <div class="stat"><b id="time">0s</b><span>Time</span></div>
          <div class="stat"><b id="correct">0</b><span>Correct</span></div>
          <div class="stat"><b id="wrong">0</b><span>Wrong</span></div>
        </div>

        <div class="note" id="note">
          <b>Rule:</b> One attempt per key. Correct keys activate the lock. Wrong keys jam permanently.
        </div>

        <div style="margin-top:10px;color:var(--muted);font-size:12.5px;line-height:1.4">
          <b>Design note:</b> This keeps mechanics simple so attention stays on the Email Security concepts.
        </div>
      </div>
    </aside>
  </div>
</div>

<!-- Modal -->
<div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Question modal">
  <div class="modal" id="modal">
    <div class="mHead">
      <div>
        <h3 id="mTitle">KEY 1</h3>
        <small id="mSub">One attempt only</small>
      </div>
      <button class="btn" id="closeBtn" type="button">Close</button>
    </div>
    <div class="mBody">
      <div class="qText" id="qText"></div>
      <div class="choices" id="choices"></div>
    </div>
    <div class="mFoot">
      <div id="feedback" style="color:var(--muted)">Choose the best answer.</div>
      <button class="btn primary" id="nextBtn" type="button" disabled>Continue</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ===========================
   Question Bank (Email Security chapter-derived)
   - No "All of the above"
   - Balanced correct options
=========================== */
const QUESTION_BANK = [
  {
    q: "Phishing emails are mainly designed to:",
    choices: [
      "Improve email delivery speed",
      "Trick users into revealing confidential information or installing malware",
      "Increase storage quota in webmail",
      "Automatically encrypt all messages"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: Phishing attempts to steal information or deliver malware.",
    feedbackWrong: "Incorrect: Phishing is used to steal information or deliver malware."
  },
  {
    q: "A common phishing technique is to:",
    choices: [
      "Send a link to a hoax but authentic-looking website",
      "Only send emails in plain text to avoid filters",
      "Disable attachments in all email clients",
      "Use BCC for every message"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: Phishing often uses hoax websites that look genuine.",
    feedbackWrong: "Incorrect: A classic phishing method is a fake website link."
  },
  {
    q: "Which sign may indicate a phishing email?",
    choices: [
      "The email uses strong encryption automatically",
      "The senderâ€™s email address differs from the organisationâ€™s real website domain",
      "The email is always sent from your own contacts only",
      "The subject line is always empty"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: Mismatched sender/website domains are a known warning sign.",
    feedbackWrong: "Incorrect: A mismatched sender domain is a key warning sign."
  },
  {
    q: "A recommended safe action when you are unsure about an email is to:",
    choices: [
      "Click the link to verify quickly",
      "Reply to ask for confirmation",
      "Contact the organisation using a phone number you know is authentic",
      "Forward it to colleagues for advice"
    ],
    answerIndex: 2,
    feedbackCorrect: "Correct: Verify using an independent, trusted contact method.",
    feedbackWrong: "Incorrect: The safest step is to contact via a known authentic number."
  },
  {
    q: "A safe practice for links in suspicious emails is to:",
    choices: [
      "Open them only on mobile phones",
      "Hover over the link to reveal the true destination before clicking",
      "Click immediately, then close the tab",
      "Copy the link into a public forum to ask others"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: Hovering can reveal the actual destination URL.",
    feedbackWrong: "Incorrect: Hovering helps reveal the true destination before clicking."
  },
  {
    q: "Why is replying to spam risky?",
    choices: [
      "It deletes your inbox automatically",
      "It confirms to spammers that your email address exists",
      "It forces your email provider to disable your account",
      "It encrypts your messages permanently"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: Replying validates your address to spammers.",
    feedbackWrong: "Incorrect: Replying can confirm your address is active."
  },
  {
    q: "Which of the following is an example of spam?",
    choices: [
      "A verified invoice from your vendor",
      "An unsolicited message advertising online gambling services",
      "A password reset you requested",
      "A security alert from your own IT team"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: Unsolicited advertising (e.g., gambling) is typical spam.",
    feedbackWrong: "Incorrect: Unsolicited advertising is a common spam category."
  },
  {
    q: "Spammers can obtain email addresses by:",
    choices: [
      "Buying lists from illicit sources",
      "Hacking legitimate websites to gather user details",
      "Using automated software to generate addresses",
      "All three listed methods"
    ],
    answerIndex: 3,
    feedbackCorrect: "Correct: Spammers use multiple methods including automation, hacking, and bought lists.",
    feedbackWrong: "Incorrect: The chapter describes all these as ways spammers get addresses."
  },
  {
    q: "When sending to many recipients, a recommended privacy practice is to use:",
    choices: [
      "CC so everyone can see each other",
      "BCC so recipients do not see othersâ€™ addresses",
      "The subject line for addresses",
      "No recipient field at all"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: BCC prevents sharing recipientsâ€™ email addresses.",
    feedbackWrong: "Incorrect: BCC is recommended to protect recipientsâ€™ addresses."
  },
  {
    q: "A safe webmail practice is to:",
    choices: [
      "Always stay signed in on shared computers",
      "Use strong passwords and log out after use",
      "Disable spam filtering permanently",
      "Only use non-secure connections"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: Strong passwords and logging out are recommended.",
    feedbackWrong: "Incorrect: Strong passwords and logging out are key webmail safety steps."
  },

  // Thunderbird / OpenPGP section
  {
    q: "Why is device encryption important when using an email client like Thunderbird?",
    choices: [
      "Because Thunderbird stores a local copy of your sent and received emails",
      "Because it increases monitor brightness",
      "Because it blocks all phishing automatically",
      "Because it prevents spam from being sent"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: Local email copies make device protection important.",
    feedbackWrong: "Incorrect: Thunderbird stores local copies, so device encryption matters."
  },
  {
    q: "Thunderbird cannot protect you if you:",
    choices: [
      "Open malicious attachments or click malicious links",
      "Use IMAP instead of POP",
      "Rename your folders",
      "Use a strong password"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: Unsafe clicks/attachments can still compromise a device.",
    feedbackWrong: "Incorrect: Clicking malicious links/opening attachments can still compromise you."
  },
  {
    q: "Which option best describes IMAP compared to POP (as per the chapter)?",
    choices: [
      "IMAP keeps the master copy on the server and syncs across devices",
      "IMAP deletes all mail from the server immediately",
      "POP always syncs across devices automatically",
      "POP stores the master copy on the server and never downloads locally"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: IMAP keeps folders on the server and syncs across devices.",
    feedbackWrong: "Incorrect: IMAP stores the master copy on the server and syncs."
  },
  {
    q: "A basic encryption indicator for email provider settings mentioned in the chapter is:",
    choices: [
      "SSL or STARTTLS shown for incoming/outgoing",
      "A red background in the inbox",
      "A GIF in the email signature",
      "A longer subject line"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: SSL/STARTTLS indicates basic encryption support by provider.",
    feedbackWrong: "Incorrect: SSL/STARTTLS is the indicator described."
  },
  {
    q: "Why does the chapter recommend disabling HTML email display (view as plain text)?",
    choices: [
      "HTML email can expose you to attacks similar to those used on web browsers",
      "Plain text emails are always shorter",
      "HTML emails cannot be archived",
      "Plain text prevents spam entirely"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: HTML rendering can increase exposure to certain attacks.",
    feedbackWrong: "Incorrect: The chapter notes HTML email can expose you to browser-like attacks."
  },
  {
    q: "Thunderbirdâ€™s master password is recommended mainly to:",
    choices: [
      "Encrypt stored passwords/passphrases in Thunderbird",
      "Increase mailbox size",
      "Force all emails to be encrypted end-to-end",
      "Prevent receiving newsletters"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: A master password helps encrypt stored credentials.",
    feedbackWrong: "Incorrect: The master password protects stored credentials in Thunderbird."
  },
  {
    q: "In Thunderbird privacy preferences, disabling remote content helps because:",
    choices: [
      "Remote images/content can be used for tracking and other risks",
      "It increases the font size automatically",
      "It converts emails to PDF",
      "It blocks outgoing mail"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: Remote content can be used to track users.",
    feedbackWrong: "Incorrect: Remote content can be used for tracking and other risks."
  },
  {
    q: "In OpenPGP, the private key should be treated as:",
    choices: [
      "Public information to share widely",
      "Extremely sensitive; it can decrypt messages and sign as you",
      "Something that can safely be emailed to others",
      "Unimportant if you use PGP/MIME"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: The private key is highly sensitive and must be protected.",
    feedbackWrong: "Incorrect: The private key is extremely sensitive and must be protected."
  },
  {
    q: "In OpenPGP, the public key is:",
    choices: [
      "Used to read encrypted emails meant for you",
      "Meant to be shared so others can encrypt messages to you",
      "A secret that should never be shared",
      "A replacement for your email password"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: Others need your public key to send you encrypted email.",
    feedbackWrong: "Incorrect: The public key is meant to be shared for encryption to you."
  },
  {
    q: "Why should you verify a correspondentâ€™s public key (e.g., via fingerprint)?",
    choices: [
      "To ensure the key really belongs to the person you intend to communicate with",
      "To increase spam filtering accuracy",
      "To make the subject line encrypted",
      "To remove all old emails from the server"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: Verification prevents encrypting to the wrong key (MITM risk).",
    feedbackWrong: "Incorrect: Fingerprint verification ensures the key belongs to the right person."
  },
  {
    q: "A revocation certificate is important because it helps you:",
    choices: [
      "Recover deleted spam messages",
      "Tell others a key is no longer valid (lost/compromised/forgotten passphrase)",
      "Disable all HTML emails permanently",
      "Increase the key length automatically"
    ],
    answerIndex: 1,
    feedbackCorrect: "Correct: Revocation lets you mark keys as invalid if compromised/lost, etc.",
    feedbackWrong: "Incorrect: Revocation certificates help invalidate keys when needed."
  },
  {
    q: "According to the chapter, which information is NOT encrypted by GnuPG email encryption?",
    choices: [
      "The subject line",
      "The encrypted message body",
      "The encrypted attachments (when properly configured)",
      "The digital signature (when used)"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: The chapter states the subject line is not encrypted.",
    feedbackWrong: "Incorrect: The subject line is not encrypted."
  },
  {
    q: "Why does the chapter recommend using PGP/MIME by default?",
    choices: [
      "It better handles attachment encryption (including file names) compared to inline PGP",
      "It makes emails shorter",
      "It prevents password reuse",
      "It disables junk folders"
    ],
    answerIndex: 0,
    feedbackCorrect: "Correct: PGP/MIME improves encryption handling for attachments.",
    feedbackWrong: "Incorrect: PGP/MIME is recommended for better attachment encryption support."
  }
];

/* ===========================
   Game Settings
=========================== */
const KEY_COUNT = 10; // Keys shown around lock (like your sample image)
const SCORE_PER_CORRECT = 10;

let state = {
  keys: [], // {status:'locked'|'open'|'jam', attempted:boolean, qIndex:number}
  currentKey: null,
  score: 0,
  correct: 0,
  wrong: 0,
  startTime: Date.now(),
  muted: false
};

/* ===========================
   Sound: tiny oscillator tones (no external files)
=========================== */
function beep(type){
  if(state.muted) return;
  const ctx = beep.ctx || (beep.ctx = new (window.AudioContext || window.webkitAudioContext)());
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = "sine";
  const now = ctx.currentTime;

  const presets = {
    click: [420, 0.035],
    good:  [720, 0.085],
    bad:   [170, 0.11],
    win:   [540, 0.14]
  };
  const [freq, dur] = presets[type] || presets.click;

  o.frequency.setValueAtTime(freq, now);
  g.gain.setValueAtTime(0.0001, now);
  g.gain.exponentialRampToValueAtTime(0.15, now + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, now + dur);

  o.connect(g); g.connect(ctx.destination);
  o.start(now);
  o.stop(now + dur + 0.02);
}

/* ===========================
   Helpers
=========================== */
const el = (id)=>document.getElementById(id);
const overlay = el("overlay");
const qText = el("qText");
const choicesEl = el("choices");
const mTitle = el("mTitle");
const feedbackEl = el("feedback");
const nextBtn = el("nextBtn");
const closeBtn = el("closeBtn");
const toast = el("toast");

function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"), 900);
}
function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }
function formatTime(sec){
  sec = Math.max(0, Math.floor(sec));
  if(sec < 60) return sec + "s";
  const m = Math.floor(sec/60), s = sec%60;
  return `${m}m ${String(s).padStart(2,"0")}s`;
}

/* ===========================
   Key SVG (conceptual, like your reference image)
=========================== */
function keySVG(status, variant){
  // variant 0..3 to vary color a bit for visuals
  const isOpen = status === "open";
  const isJam = status === "jam";

  const palettes = [
    {a:"#E8EEF9", b:"#7E8AA0", c:"#2B3445"},
    {a:"#E6FFF6", b:"#34D399", c:"#0C5F43"},
    {a:"#FFF1F2", b:"#FB7185", c:"#7A1C35"},
    {a:"#FFF7D6", b:"#F7D36A", c:"#B8872B"}
  ];

  // default steel; open becomes gold/green; jam becomes red
  const p = isOpen ? palettes[3] : isJam ? palettes[2] : palettes[0];
  const accent = isOpen ? "rgba(247,211,106,.55)" : isJam ? "rgba(255,90,122,.35)" : "rgba(85,214,255,.18)";

  // flip key direction based on side
  const flip = variant === 1 ? "scale(-1,1) translate(-120,0)" : "";

  return `
  <svg class="keyIcon" viewBox="0 0 120 40" aria-hidden="true">
    <defs>
      <linearGradient id="kg_${variant}_${status}" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0" stop-color="${p.a}"/>
        <stop offset=".5" stop-color="${p.b}"/>
        <stop offset="1" stop-color="${p.c}"/>
      </linearGradient>
    </defs>
    <g transform="${flip}">
      <rect x="6" y="16" width="70" height="10" rx="5" fill="url(#kg_${variant}_${status})"/>
      <circle cx="90" cy="21" r="14" fill="url(#kg_${variant}_${status})"/>
      <circle cx="90" cy="21" r="7" fill="rgba(0,0,0,.45)"/>
      <rect x="18" y="23" width="10" height="7" rx="2" fill="rgba(0,0,0,.35)"/>
      <rect x="32" y="23" width="10" height="7" rx="2" fill="rgba(0,0,0,.35)"/>

      <path d="M6 21h70" stroke="${accent}" stroke-width="3" stroke-linecap="round" opacity=".7"/>
    </g>
  </svg>`;
}

/* ===========================
   Build keys UI (left/right + mobile)
=========================== */
function nextPlayableKeyIndex(){
  return state.keys.findIndex(k => k.status === "locked");
}

function renderKeys(){
  const left = el("keysLeft");
  const right = el("keysRight");
  const mob = el("keysMobile");
  left.innerHTML = "";
  right.innerHTML = "";
  mob.innerHTML = "";

  state.keys.forEach((k, idx)=>{
    const nextIdx = nextPlayableKeyIndex();
    const playable = idx === nextIdx;
    const lockedOut = (k.status === "locked" && !playable);

    const pipClass = k.status === "open" ? "statusPip good" :
                     k.status === "jam" ? "statusPip bad" : "statusPip";

    const hint = k.status === "open" ? "Activated" :
                 k.status === "jam" ? "Jammed" :
                 playable ? "Tap to attempt" : "Locked (in order)";

    // Desktop button
    const btn = document.createElement("div");
    btn.className = "keyBtn" + (lockedOut ? " disabled" : "");
    btn.setAttribute("role","button");
    btn.setAttribute("tabindex", lockedOut ? "-1" : "0");
    btn.innerHTML = `
      <div class="keyLabel">
        <b>KEY ${idx+1}</b>
        <small>${hint}</small>
      </div>
      <div style="display:flex;align-items:center;gap:10px;">
        <i class="${pipClass}" aria-hidden="true"></i>
        ${keySVG(k.status, idx%2)}
      </div>
    `;
    btn.addEventListener("click", ()=>onKeyClick(idx));
    btn.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" || e.key===" "){ e.preventDefault(); onKeyClick(idx); }
    });

    // split keys like your reference image: 5 left, 5 right
    if(idx < Math.ceil(KEY_COUNT/2)) left.appendChild(btn);
    else right.appendChild(btn);

    // Mobile cards
    const card = document.createElement("div");
    card.className = "keyCard" + (lockedOut ? " disabled" : "");
    card.innerHTML = `
      <div>
        <b>KEY ${idx+1}</b>
        <small>${hint}</small>
      </div>
      <div style="display:flex;align-items:center;gap:10px;">
        <i class="${pipClass}" aria-hidden="true"></i>
      </div>
    `;
    card.addEventListener("click", ()=>onKeyClick(idx));
    mob.appendChild(card);
  });
}

/* ===========================
   Modal logic
=========================== */
function onKeyClick(idx){
  const nextIdx = nextPlayableKeyIndex();
  if(idx !== nextIdx){
    showToast("Use keys in order.");
    beep("click");
    return;
  }
  const k = state.keys[idx];
  if(k.attempted){
    showToast("Already attempted.");
    return;
  }
  state.currentKey = idx;
  openQuestion(idx);
}

function openQuestion(keyIdx){
  const k = state.keys[keyIdx];
  const qObj = QUESTION_BANK[k.qIndex];

  mTitle.textContent = `KEY ${keyIdx+1}`;
  el("mSub").textContent = "One attempt only â€¢ choose carefully";
  qText.textContent = qObj.q;

  feedbackEl.textContent = "Choose the best answer.";
  nextBtn.disabled = true;
  choicesEl.innerHTML = "";

  qObj.choices.forEach((ch, i)=>{
    const b = document.createElement("button");
    b.className = "choice";
    b.type = "button";
    b.textContent = ch;
    b.addEventListener("click", ()=>answer(keyIdx, i));
    choicesEl.appendChild(b);
  });

  overlay.classList.add("show");
  beep("click");
}

function closeModal(){
  overlay.classList.remove("show");
  state.currentKey = null;
}

closeBtn.addEventListener("click", ()=>{beep("click"); closeModal();});
overlay.addEventListener("click", (e)=>{
  if(e.target === overlay){beep("click"); closeModal();}
});

nextBtn.addEventListener("click", ()=>{
  beep("click");
  closeModal();
  checkCompletion();
});

function disableChoices(){
  [...choicesEl.querySelectorAll(".choice")].forEach(x=>x.disabled = true);
}

function answer(keyIdx, chosenIndex){
  const k = state.keys[keyIdx];
  if(k.attempted) return;

  k.attempted = true;

  const qObj = QUESTION_BANK[k.qIndex];
  const correct = chosenIndex === qObj.answerIndex;

  disableChoices();

  // Color choices
  const btns = [...choicesEl.querySelectorAll(".choice")];
  btns.forEach((b, i)=>{
    if(i === qObj.answerIndex) b.classList.add("good");
    if(i === chosenIndex && !correct) b.classList.add("bad");
  });

  if(correct){
    k.status = "open";
    state.score += SCORE_PER_CORRECT;
    state.correct += 1;
    feedbackEl.textContent = qObj.feedbackCorrect || "Correct.";
    beep("good");
    successFX();
    showToast("Key activated!");
  }else{
    k.status = "jam";
    state.wrong += 1;
    feedbackEl.textContent = qObj.feedbackWrong || "Wrong.";
    beep("bad");
    failFX();
    showToast("Key jammed!");
  }

  nextBtn.disabled = false;
  renderKeys();
  updateHUD();
}

function successFX(){
  // bright pulse + confetti
  el("arena").classList.remove("pulse");
  void el("arena").offsetWidth;
  el("arena").classList.add("pulse");
  fireConfetti(false);
}

function failFX(){
  el("arena").classList.remove("shake");
  void el("arena").offsetWidth;
  el("arena").classList.add("shake");
}

/* ===========================
   Completion logic
=========================== */
function checkCompletion(){
  const remaining = state.keys.filter(k=>k.status==="locked").length;
  if(remaining !== 0) return;

  const anyJam = state.keys.some(k=>k.status==="jam");
  if(anyJam){
    el("note").innerHTML = "<b>Result:</b> Access denied. Some keys jammed. Reset to try again.";
    showToast("Access denied.");
    beep("bad");
  }else{
    el("note").innerHTML = "<b>Result:</b> Vault unlocked successfully. Well done.";
    showToast("Vault unlocked!");
    beep("win");
    fireConfetti(true);
    el("lockGlow").animate([
      {transform:"scale(1)", opacity:1},
      {transform:"scale(1.08)", opacity:1},
      {transform:"scale(1)", opacity:1}
    ], {duration: 700, easing:"ease-out"});
  }
}

/* ===========================
   HUD
=========================== */
function updateHUD(){
  const done = state.keys.filter(k=>k.status!=="locked").length;
  el("done").textContent = String(done);
  el("total").textContent = String(KEY_COUNT);
  el("score").textContent = String(state.score);

  const attempted = state.correct + state.wrong;
  const acc = attempted ? Math.round((state.correct/attempted)*100) : 0;
  el("acc").textContent = acc + "%";
  el("correct").textContent = String(state.correct);
  el("wrong").textContent = String(state.wrong);

  const sec = (Date.now() - state.startTime)/1000;
  el("time").textContent = formatTime(sec);

  const pct = Math.round((done/KEY_COUNT)*100);
  el("barFill").style.width = pct + "%";
  el("barText").textContent = `${pct}% keys used`;
}
setInterval(updateHUD, 500);

/* ===========================
   Confetti
=========================== */
const confettiCanvas = el("confetti");
const ctx2 = confettiCanvas.getContext("2d");
let confettiParticles = [];

function resizeConfettiCanvas(){
  const arena = el("arena");
  const r = arena.getBoundingClientRect();
  confettiCanvas.width = Math.floor(r.width * devicePixelRatio);
  confettiCanvas.height = Math.floor(r.height * devicePixelRatio);
  confettiCanvas.style.width = r.width + "px";
  confettiCanvas.style.height = r.height + "px";
}
window.addEventListener("resize", resizeConfettiCanvas);

function fireConfetti(big){
  confettiCanvas.classList.add("show");
  setTimeout(()=>confettiCanvas.classList.remove("show"), 1200);

  const w = confettiCanvas.width, h = confettiCanvas.height;
  const count = big ? 180 : 70;

  for(let i=0;i<count;i++){
    confettiParticles.push({
      x: w*0.5 + (Math.random()-0.5)*w*0.30,
      y: h*0.20 + (Math.random()-0.5)*h*0.10,
      vx: (Math.random()-0.5) * (big ? 8 : 5) * devicePixelRatio,
      vy: (Math.random()*6 + 4) * devicePixelRatio,
      r: (Math.random()*5 + 3) * devicePixelRatio,
      rot: Math.random()*Math.PI,
      vr: (Math.random()-0.5)*0.25,
      life: 1,
      fade: Math.random()*0.02 + 0.012
    });
  }
}
function tickConfetti(){
  const w = confettiCanvas.width, h = confettiCanvas.height;
  ctx2.clearRect(0,0,w,h);

  confettiParticles.forEach(p=>{
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.14 * devicePixelRatio;
    p.rot += p.vr;
    p.life -= p.fade;

    ctx2.save();
    ctx2.translate(p.x, p.y);
    ctx2.rotate(p.rot);
    ctx2.globalAlpha = clamp(p.life,0,1);
    // random HSL (no fixed palette)
    ctx2.fillStyle = `hsl(${Math.floor(Math.random()*360)}, 90%, 60%)`;
    ctx2.fillRect(-p.r, -p.r*0.5, p.r*2, p.r);
    ctx2.restore();
  });

  confettiParticles = confettiParticles.filter(p=>p.life>0 && p.y < h + 80*devicePixelRatio);
  requestAnimationFrame(tickConfetti);
}
tickConfetti();

/* ===========================
   Init / Reset
=========================== */
function init(){
  state.score = 0;
  state.correct = 0;
  state.wrong = 0;
  state.startTime = Date.now();
  state.currentKey = null;

  // assign first N questions; if fewer, loop (better to keep bank >= KEY_COUNT)
  state.keys = Array.from({length: KEY_COUNT}, (_, i)=>({
    status: "locked",
    attempted: false,
    qIndex: i % QUESTION_BANK.length
  }));

  renderKeys();
  updateHUD();
  resizeConfettiCanvas();

  el("note").innerHTML = "<b>Rule:</b> One attempt per key. Correct keys activate the lock. Wrong keys jam permanently.";
}

el("resetBtn").addEventListener("click", ()=>{
  beep("click");
  init();
  showToast("Reset done.");
});

el("muteBtn").addEventListener("click", ()=>{
  state.muted = !state.muted;
  el("muteBtn").textContent = state.muted ? "ðŸ”‡ Muted" : "ðŸ”Š Sound";
  showToast(state.muted ? "Sound off" : "Sound on");
});

init();
</script>
</body>
</html>
